"use strict";var Kt=Object.create;var ue=Object.defineProperty;var Jt=Object.getOwnPropertyDescriptor;var Zt=Object.getOwnPropertyNames;var Yt=Object.getPrototypeOf,qt=Object.prototype.hasOwnProperty;var Qt=(e,r)=>{for(var t in r)ue(e,t,{get:r[t],enumerable:!0})},He=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Zt(r))!qt.call(e,a)&&a!==t&&ue(e,a,{get:()=>r[a],enumerable:!(n=Jt(r,a))||n.enumerable});return e};var x=(e,r,t)=>(t=e!=null?Kt(Yt(e)):{},He(r||!e||!e.__esModule?ue(t,"default",{value:e,enumerable:!0}):t,e)),Xt=e=>He(ue({},"__esModule",{value:!0}),e);var Nr={};Qt(Nr,{default:()=>Wt});module.exports=Xt(Nr);var I=require("@raycast/api"),Vt=require("react");var nr=require("@raycast/api");var et=x(require("fs"));var Se=x(require("fs")),ae=x(require("path"));var Ge=require("@raycast/api"),Ke=()=>{if(!process.env.HOME)throw new Error("$HOME environment variable is not set.");return ae.default.join(process.env.HOME,"Library")},Je=(e,r)=>{let{profilePath:t}=(0,Ge.getPreferenceValues)(),n;return t?n=ae.default.join(t,e):n=ae.default.join(Ke(),...Qe,r??P,e),n},Ze=e=>Je("History",e),fe=()=>ae.default.join(Ke(),...Xe),er=e=>Je("Bookmarks",e);function Ye(e){let r=[];return e.type==="folder"?e.children.forEach(t=>{r.push(...Ye(t))}):e.type==="url"&&e.url&&r.push({id:e.id,url:e.url,title:e.name,lastVisited:new Date(e.date_added)}),r}var tr=e=>{let r=[];return Object.keys(e.roots).forEach(t=>{let n=e.roots[t],a=Ye(n);r.push(...a)}),r},qe=async e=>{let r=er(e);if(!Se.default.existsSync(r))throw new Error(de);let t=await Se.default.promises.readFile(r,{encoding:"utf-8"});return tr(JSON.parse(t))};var rr=()=>{try{let e=fe(),r=et.default.readFileSync(e,"utf-8"),t=JSON.parse(r).profile.info_cache;return t?Object.keys(t)[0]:"Default"}catch{return"Default"}},Qe=["Application Support","Google","Chrome"],Xe=["Application Support","Google","Chrome","Local State"],P=rr(),M="CHROME_PROFILE_KEY",tt="CHROME_PROFILES_KEY",rt=`
  # \u{1F6A8}Error: Google Chrome browser is not installed
  ## This extension depends on Google Chrome browser. You must install it to continue.

  If you have [Homebrew](https://brew.sh/) installed then press \u23CE (Enter Key) to install Google Chrome browser.

  [Click here](https://www.google.com/chrome/) if you want to download manually.

  [![Google Chrome](https://www.google.com/chrome/static/images/chrome-logo-m100.svg)]()
`;var nt=`
# \u{1F6A8}Error: Something happened while trying to run your command

[![Google Chrome](https://www.google.com/chrome/static/images/chrome-logo-m100.svg)]()
`,he="An Error Occurred",q="Google Chrome not installed",de="Google Chrome has no bookmarks.";var ar=require("react/jsx-runtime");var ot=require("react"),R=require("@raycast/api"),ve=require("child_process");var it=require("os"),st=require("path"),pe=require("react/jsx-runtime"),or=(()=>{try{return(0,ve.execSync)("brew --prefix",{encoding:"utf8"}).trim()}catch{return(0,it.cpus)()[0].model.includes("Apple")?"/opt/homebrew":"/usr/local"}})();function at(){return(0,st.join)(or,"bin/brew")}function ir(e){try{return(0,ve.execSync)(`${at()} install --cask ${e}`,{maxBuffer:10*1024*1024})}catch(r){let t=r;throw t&&t.code===127?(t.stderr=`Brew executable not found at ${at()}`,t):r}}function Q(){let[e,r]=(0,ot.useState)(!0);return(0,pe.jsx)(R.Detail,{actions:(0,pe.jsx)(R.ActionPanel,{children:e&&(0,pe.jsx)(R.Action,{title:"Install with Homebrew",onAction:async()=>{if(!e)return;let t=new R.Toast({style:R.Toast.Style.Animated,title:"Installing..."});await t.show();try{ir("google-chrome"),await t.hide()}catch{await t.hide(),await(0,R.showToast)(R.Toast.Style.Failure,he,"An unknown error occurred while trying to install")}t.title="Installed! Please go back and try again.",t.style=R.Toast.Style.Success,await t.show(),r(!1)}})}),markdown:rt})}var X=require("@raycast/api");var ct=require("react/jsx-runtime");function me(){return(0,X.showToast)(X.Toast.Style.Failure,he,"Something happened while trying to run your command"),(0,ct.jsx)(X.Detail,{markdown:nt})}var b=require("@raycast/api");var lt=x(require("node:process"),1),ut=require("node:util"),Te=require("node:child_process"),sr=(0,ut.promisify)(Te.execFile);async function H(e,{humanReadableOutput:r=!0,signal:t}={}){if(lt.default.platform!=="darwin")throw new Error("macOS only");let n=r?[]:["-ss"],a={};t&&(a.signal=t);let{stdout:i}=await sr("osascript",["-e",e,n],a);return i.trim()}var z=require("@raycast/api");var h=x(require("react")),u=require("@raycast/api");var ft=Object.prototype.hasOwnProperty;function ge(e,r){var t,n;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((n=e.length)===r.length)for(;n--&&ge(e[n],r[n]););return n===-1}if(!t||typeof e=="object"){n=0;for(t in e)if(ft.call(e,t)&&++n&&!ft.call(r,t)||!(t in r)||!ge(e[t],r[t]))return!1;return Object.keys(r).length===n}}return e!==e&&r!==r}var L=x(require("node:fs")),V=x(require("node:path")),wt=x(require("node:crypto")),Ae=x(require("node:child_process")),$t=require("node:buffer"),te=x(require("node:stream")),kt=require("node:util"),C=require("node:fs/promises");var A=require("react/jsx-runtime"),$e=x(require("node:os")),xt=require("node:url"),Re=globalThis;function cr(e){let r=(0,h.useRef)(e),t=(0,h.useRef)(0);return ge(e,r.current)||(r.current=e,t.current+=1),(0,h.useMemo)(()=>r.current,[t.current])}function _(e){let r=(0,h.useRef)(e);return r.current=e,r}function Et(e,r){let t=e instanceof Error?e.message:String(e);return(0,u.showToast)({style:u.Toast.Style.Failure,title:r?.title??"Something went wrong",message:r?.message??t,primaryAction:r?.primaryAction??dt(e),secondaryAction:r?.primaryAction?dt(e):void 0})}var dt=e=>{let r=!0,t="[Extension Name]...",n="";try{let o=JSON.parse((0,L.readFileSync)((0,V.join)(u.environment.assetsPath,"..","package.json"),"utf8"));t=`[${o.title}]...`,n=`https://raycast.com/${o.owner||o.author}/${o.name}`,(!o.owner||o.access==="public")&&(r=!1)}catch{}let a=u.environment.isDevelopment||r,i=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(o){o.hide(),a?u.Clipboard.copy(i):(0,u.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};function re(e,r,t){let n=(0,h.useRef)(0),[a,i]=(0,h.useState)({isLoading:!0}),o=_(e),c=_(t?.abortable),s=_(r||[]),l=_(t?.onError),f=_(t?.onData),d=_(t?.onWillExecute),y=_(t?.failureToastOptions),p=_(a.data),k=(0,h.useRef)(null),m=(0,h.useRef)({page:0}),S=(0,h.useRef)(!1),U=(0,h.useRef)(!0),ce=(0,h.useRef)(50),v=(0,h.useCallback)(()=>(c.current&&(c.current.current?.abort(),c.current.current=new AbortController),++n.current),[c]),w=(0,h.useCallback)((...N)=>{let T=v();d.current?.(N),i(g=>({...g,isLoading:!0}));let Z=lr(o.current)(...N);function Y(g){return g.name=="AbortError"||T===n.current&&(l.current?l.current(g):u.environment.launchType!==u.LaunchType.Background&&Et(g,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(j){j.hide(),k.current?.(...s.current||[])}},...y.current}),i({error:g,isLoading:!1})),g}return typeof Z=="function"?(S.current=!0,Z(m.current).then(({data:g,hasMore:j,cursor:Ht})=>(T===n.current&&(m.current&&(m.current.cursor=Ht,m.current.lastItem=g?.[g.length-1]),f.current&&f.current(g,m.current),j&&(ce.current=g.length),U.current=j,i(Gt=>m.current.page===0?{data:g,isLoading:!1}:{data:(Gt.data||[])?.concat(g),isLoading:!1})),g),g=>(U.current=!1,Y(g)))):(S.current=!1,Z.then(g=>(T===n.current&&(f.current&&f.current(g),i({data:g,isLoading:!1})),g),Y))},[f,l,s,o,i,k,d,m,y,v]);k.current=w;let D=(0,h.useCallback)(()=>{m.current={page:0};let N=s.current||[];return w(...N)},[w,s]),J=(0,h.useCallback)(async(N,T)=>{let Z;try{if(T?.optimisticUpdate){v(),typeof T?.rollbackOnError!="function"&&T?.rollbackOnError!==!1&&(Z=structuredClone(p.current?.value));let Y=T.optimisticUpdate;i(g=>({...g,data:Y(g.data)}))}return await N}catch(Y){if(typeof T?.rollbackOnError=="function"){let g=T.rollbackOnError;i(j=>({...j,data:g(j.data)}))}else T?.optimisticUpdate&&T?.rollbackOnError!==!1&&i(g=>({...g,data:Z}));throw Y}finally{T?.shouldRevalidateAfter!==!1&&(u.environment.launchType===u.LaunchType.Background||u.environment.commandMode==="menu-bar"?await D():D())}},[D,p,i,v]),le=(0,h.useCallback)(()=>{m.current.page+=1;let N=s.current||[];w(...N)},[m,s,w]);(0,h.useEffect)(()=>{m.current={page:0},t?.execute!==!1?w(...r||[]):v()},[cr([r,t?.execute,w]),c,m]),(0,h.useEffect)(()=>()=>{v()},[v]);let zt=t?.execute!==!1?a.isLoading:!1,Bt={...a,isLoading:zt},jt=S.current?{pageSize:ce.current,hasMore:U.current,onLoadMore:le}:void 0;return{...Bt,revalidate:D,mutate:J,pagination:jt}}function lr(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function ht(e){return typeof e!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))!==null}function ur(e){return e instanceof URLSearchParams?e.toString():e}function St(e,r=[]){function t(n){return"update"in e?e.update(n,"utf8"):e.write(n)}return{dispatch:function(n){n=ur(n),n===null?this._null():this["_"+typeof n](n)},_object:function(n){let a=/\[object (.*)\]/i,i=Object.prototype.toString.call(n),o=a.exec(i)?.[1]??"unknown:["+i+"]";o=o.toLowerCase();let c=null;if((c=r.indexOf(n))>=0){this.dispatch("[CIRCULAR:"+c+"]");return}else r.push(n);if(Buffer.isBuffer(n))return t("buffer:"),t(n.toString("utf8"));if(o!=="object"&&o!=="function"&&o!=="asyncfunction")if(this["_"+o])this["_"+o](n);else throw new Error('Unknown object type "'+o+'"');else{let s=Object.keys(n);s=s.sort(),ht(n)||s.splice(0,0,"prototype","__proto__","constructor"),t("object:"+s.length+":");let l=this;return s.forEach(function(f){l.dispatch(f),t(":"),l.dispatch(n[f]),t(",")})}},_array:function(n,a){a=typeof a<"u"?a:!1;let i=this;if(t("array:"+n.length+":"),!a||n.length<=1){n.forEach(function(s){i.dispatch(s)});return}let o=[],c=n.map(function(s){let l=fr(),f=r.slice();return St(l,f).dispatch(s),o=o.concat(f.slice(r.length)),l.read().toString()});r=r.concat(o),c.sort(),this._array(c,!1)},_date:function(n){t("date:"+n.toJSON())},_symbol:function(n){t("symbol:"+n.toString())},_error:function(n){t("error:"+n.toString())},_boolean:function(n){t("bool:"+n.toString())},_string:function(n){t("string:"+n.length+":"),t(n.toString())},_function:function(n){t("fn:"),ht(n)?this.dispatch("[native]"):this.dispatch(n.toString()),this.dispatch("function-name:"+String(n.name)),this._object(n)},_number:function(n){t("number:"+n.toString())},_xml:function(n){t("xml:"+n.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(n){t("regex:"+n.toString())},_uint8array:function(n){t("uint8array:"),this.dispatch(Array.prototype.slice.call(n))},_uint8clampedarray:function(n){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(n))},_int8array:function(n){t("int8array:"),this.dispatch(Array.prototype.slice.call(n))},_uint16array:function(n){t("uint16array:"),this.dispatch(Array.prototype.slice.call(n))},_int16array:function(n){t("int16array:"),this.dispatch(Array.prototype.slice.call(n))},_uint32array:function(n){t("uint32array:"),this.dispatch(Array.prototype.slice.call(n))},_int32array:function(n){t("int32array:"),this.dispatch(Array.prototype.slice.call(n))},_float32array:function(n){t("float32array:"),this.dispatch(Array.prototype.slice.call(n))},_float64array:function(n){t("float64array:"),this.dispatch(Array.prototype.slice.call(n))},_arraybuffer:function(n){t("arraybuffer:"),this.dispatch(new Uint8Array(n))},_url:function(n){t("url:"+n.toString())},_map:function(n){t("map:");let a=Array.from(n);this._array(a,!0)},_set:function(n){t("set:");let a=Array.from(n);this._array(a,!0)},_file:function(n){t("file:"),this.dispatch([n.name,n.size,n.type,n.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(n){t("bigint:"+n.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function fr(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}function dr(e,r){let t=this[e];return t instanceof Date?`__raycast_cached_date__${t.toString()}`:Buffer.isBuffer(t)?`__raycast_cached_buffer__${t.toString("base64")}`:r}function hr(e,r){return typeof r=="string"&&r.startsWith("__raycast_cached_date__")?new Date(r.replace("__raycast_cached_date__","")):typeof r=="string"&&r.startsWith("__raycast_cached_buffer__")?Buffer.from(r.replace("__raycast_cached_buffer__",""),"base64"):r}function ye(e){let r=wt.default.createHash("sha1");return St(r).dispatch(e),r.digest("hex")}var pr=Symbol("cache without namespace"),pt=new Map;function O(e,r,t){let n=t?.cacheNamespace||pr,a=pt.get(n)||pt.set(n,new u.Cache({namespace:t?.cacheNamespace})).get(n);if(!a)throw new Error("Missing cache");let i=_(e),o=_(r),c=(0,h.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(i.current)}catch(d){console.error("Could not get Cache data:",d);return}}),s=(0,h.useMemo)(()=>{if(typeof c<"u"){if(c==="undefined")return;try{return JSON.parse(c,hr)}catch(d){return console.warn("The cached data is corrupted",d),o.current}}else return o.current},[c,o]),l=_(s),f=(0,h.useCallback)(d=>{let y=typeof d=="function"?d(l.current):d;if(typeof y>"u")a.set(i.current,"undefined");else{let p=JSON.stringify(y,dr);a.set(i.current,p)}return y},[a,i,l]);return[s,f]}var ee=Symbol();function vt(e,r,t){let{initialData:n,keepPreviousData:a,internal_cacheKeySuffix:i,...o}=t||{},c=(0,h.useRef)(null),[s,l]=O(ye(r||[])+i,ee,{cacheNamespace:ye(e)}),f=(0,h.useRef)(s!==ee?s:n),d=(0,h.useRef)(void 0),{mutate:y,revalidate:p,...k}=re(e,r||[],{...o,onData(v,w){d.current=w,o.onData&&o.onData(v,w),!(w&&w.page>0)&&(c.current="promise",f.current=v,l(v))}}),m,S=k.pagination;d.current&&d.current.page>0&&k.data?m=k.data:c.current==="promise"?m=f.current:a&&s!==ee?(m=s,S&&(S.hasMore=!0,S.pageSize=s.length)):a&&s===ee?m=f.current:s!==ee?(m=s,S&&(S.hasMore=!0,S.pageSize=s.length)):m=n;let U=_(m),ce=(0,h.useCallback)(async(v,w)=>{let D;try{if(w?.optimisticUpdate){typeof w?.rollbackOnError!="function"&&w?.rollbackOnError!==!1&&(D=structuredClone(U.current));let J=w.optimisticUpdate(U.current);c.current="cache",f.current=J,l(J)}return await y(v,{shouldRevalidateAfter:w?.shouldRevalidateAfter})}catch(J){if(typeof w?.rollbackOnError=="function"){let le=w.rollbackOnError(U.current);c.current="cache",f.current=le,l(le)}else w?.optimisticUpdate&&w?.rollbackOnError!==!1&&(c.current="cache",f.current=D,l(D));throw J}},[l,y,U,f,c]);return(0,h.useEffect)(()=>{s!==ee&&(c.current="cache",f.current=s)},[s]),{data:m,isLoading:k.isLoading,error:k.error,mutate:d.current&&d.current.page>0?y:ce,pagination:S,revalidate:p}}var be=e=>!!e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function",_e=Symbol.for("signal-exit emitter"),Ce=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),Re[_e])return Re[_e];Object.defineProperty(Re,_e,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(r,t){this.listeners[r].push(t)}removeListener(r,t){let n=this.listeners[r],a=n.indexOf(t);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(r,t,n){if(this.emitted[r])return!1;this.emitted[r]=!0;let a=!1;for(let i of this.listeners[r])a=i(t,n)===!0||a;return r==="exit"&&(a=this.emit("afterExit",t,n)||a),a}},Ie=class{onExit(){return()=>{}}load(){}unload(){}},Oe=class{#s;#t;#e;#o;#i;#a;#n;#r;constructor(r){this.#s=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new Ce,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=r,this.#a={};for(let t of this.#r)this.#a[t]=()=>{let n=this.#e.listeners(t),{count:a}=this.#t,i=r;if(typeof i.__signal_exit_emitter__=="object"&&typeof i.__signal_exit_emitter__.count=="number"&&(a+=i.__signal_exit_emitter__.count),n.length===a){this.unload();let o=this.#t.emit("exit",null,t),c=t==="SIGHUP"?this.#s:t;o||r.kill(r.pid,c)}};this.#i=r.reallyExit,this.#o=r.emit}onExit(r,t){if(!be(this.#e))return()=>{};this.#n===!1&&this.load();let n=t?.alwaysLast?"afterExit":"exit";return this.#t.on(n,r),()=>{this.#t.removeListener(n,r),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let r of this.#r)try{let t=this.#a[r];t&&this.#e.on(r,t)}catch{}this.#e.emit=(r,...t)=>this.#l(r,...t),this.#e.reallyExit=r=>this.#c(r)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(r=>{let t=this.#a[r];if(!t)throw new Error("Listener not defined for signal: "+r);try{this.#e.removeListener(r,t)}catch{}}),this.#e.emit=this.#o,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(r){return be(this.#e)?(this.#e.exitCode=r||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(r,...t){let n=this.#o;if(r==="exit"&&be(this.#e)){typeof t[0]=="number"&&(this.#e.exitCode=t[0]);let a=n.call(this.#e,r,...t);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,r,...t)}},Pe=null,mr=(e,r)=>(Pe||(Pe=be(process)?new Oe(process):new Ie),Pe.onExit(e,r));function mt(e,{timeout:r}={}){let t=new Promise((c,s)=>{e.on("exit",(l,f)=>{c({exitCode:l,signal:f,timedOut:!1})}),e.on("error",l=>{s(l)}),e.stdin&&e.stdin.on("error",l=>{s(l)})}),n=mr(()=>{e.kill()});if(r===0||r===void 0)return t.finally(()=>n());let a,i=new Promise((c,s)=>{a=setTimeout(()=>{e.kill("SIGTERM"),s(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},r)}),o=t.finally(()=>{clearTimeout(a)});return Promise.race([i,o]).finally(()=>n())}var Le=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function gr(e){let{encoding:r}=e,t=r==="buffer",n=new te.default.PassThrough({objectMode:!1});r&&r!=="buffer"&&n.setEncoding(r);let a=0,i=[];return n.on("data",o=>{i.push(o),a+=o.length}),n.getBufferedValue=()=>t?Buffer.concat(i,a):i.join(""),n.getBufferedLength=()=>a,n}async function gt(e,r){let t=gr(r);return await new Promise((n,a)=>{let i=o=>{o&&t.getBufferedLength()<=$t.constants.MAX_LENGTH&&(o.bufferedData=t.getBufferedValue()),a(o)};(async()=>{try{await(0,kt.promisify)(te.default.pipeline)(e,t),n()}catch(o){i(o)}})(),t.on("data",()=>{t.getBufferedLength()>8e7&&i(new Le)})}),t.getBufferedValue()}async function bt(e,r){e.destroy();try{return await r}catch(t){return t.bufferedData}}async function yt({stdout:e,stderr:r},{encoding:t},n){let a=gt(e,{encoding:t}),i=gt(r,{encoding:t});try{return await Promise.all([n,a,i])}catch(o){return Promise.all([{error:o,exitCode:null,signal:o.signal,timedOut:o.timedOut||!1},bt(e,a),bt(r,i)])}}var we=class extends Error{constructor(r){super(r),this.name="PermissionError"}};function br(e){return e instanceof Error&&e.name==="PermissionError"}async function yr(e,r,t){if(!(0,L.existsSync)(e))throw new Error("The database does not exist");let n;try{n=await(l=>import(l))("node:sqlite")}catch{return wr(e,r,t)}let a=new n.DatabaseSync(e,{open:!1,readOnly:!0}),i=t?.signal;try{a.open()}catch(s){if(console.log(s),s.message.match("(5)")||s.message.match("(14)")){let l;if(!l){let f=V.default.join($e.default.tmpdir(),"useSQL",ye(e));await(0,C.mkdir)(f,{recursive:!0}),F(i),l=V.default.join(f,"db.db"),await(0,C.copyFile)(e,l),await(0,C.writeFile)(l+"-shm",""),await(0,C.writeFile)(l+"-wal",""),F(i)}a=new n.DatabaseSync(l,{open:!1,readOnly:!0}),a.open(),F(i)}}let o=a.prepare(r);F(i);let c=o.all();return a.close(),c}async function wr(e,r,t){let n=t?.signal,a=Ae.default.spawn("sqlite3",["--json","--readonly",e,r],{signal:n}),i=mt(a),[{error:o,exitCode:c,signal:s},l,f]=await yt(a,{encoding:"utf-8"},i);if(F(n),f.match("(5)")||f.match("(14)")){let d;if(!d){let y=V.default.join($e.default.tmpdir(),"useSQL",ye(e));await(0,C.mkdir)(y,{recursive:!0}),F(n),d=V.default.join(y,"db.db"),await(0,C.copyFile)(e,d),await(0,C.writeFile)(d+"-shm",""),await(0,C.writeFile)(d+"-wal",""),F(n)}a=Ae.default.spawn("sqlite3",["--json","--readonly","--vfs","unix-none",d,r],{signal:n}),i=mt(a),[{error:o,exitCode:c,signal:s},l,f]=await yt(a,{encoding:"utf-8"},i),F(n)}if(o||c!==0||s!==null)throw f.includes("authorization denied")?new we("You do not have permission to access the database."):new Error(f||"Unknown error");return JSON.parse(l.trim()||"[]")}function F(e){if(e?.aborted){let r=new Error("aborted");throw r.name="AbortError",r}}function Tt(e,r,t){let{permissionPriming:n,...a}=t||{},[i,o]=(0,h.useState)(null),c=_(t||{}),s=(0,h.useRef)(null),l=(0,h.useCallback)(d=>{console.error(d);let y=d instanceof Error&&d.message.includes("authorization denied")?new we("You do not have permission to access the database."):d;br(y)?o((0,A.jsx)($r,{priming:c.current.permissionPriming})):c.current.onError?c.current.onError(y):u.environment.launchType!==u.LaunchType.Background&&Et(y,{title:"Cannot query the data"})},[c]),f=(0,h.useMemo)(()=>{if(!(0,L.existsSync)(e))throw new Error("The database does not exist");return async(d,y)=>{let p=s.current?.signal;return yr(d,y,{signal:p})}},[e]);return{...re(f,[e,r],{...a,onError:l}),permissionView:i}}function $r(e){let r=parseInt($e.default.release().split(".")[0])>=22,t=r?"Settings":"Preferences",n=r?{title:"Open System Settings -> Privacy",target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"}:{title:"Open System Preferences -> Security",target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"};return u.environment.commandMode==="menu-bar"?(0,A.jsxs)(u.MenuBarExtra,{icon:u.Icon.Warning,title:u.environment.commandName,children:[(0,A.jsx)(u.MenuBarExtra.Item,{title:"Raycast needs full disk access",tooltip:`You can revert this access in ${t} whenever you want`}),e.priming?(0,A.jsx)(u.MenuBarExtra.Item,{title:e.priming,tooltip:`You can revert this access in ${t} whenever you want`}):null,(0,A.jsx)(u.MenuBarExtra.Separator,{}),(0,A.jsx)(u.MenuBarExtra.Item,{title:n.title,onAction:()=>(0,u.open)(n.target)})]}):(0,A.jsx)(u.List,{children:(0,A.jsx)(u.List.EmptyView,{icon:{source:{light:"https://raycast.com/uploads/extensions-utils-security-permissions-light.png",dark:"https://raycast.com/uploads/extensions-utils-security-permissions-dark.png"}},title:"Raycast needs full disk access.",description:`${e.priming?e.priming+`
`:""}You can revert this access in ${t} whenever you want.`,actions:(0,A.jsx)(u.ActionPanel,{children:(0,A.jsx)(u.Action.Open,{...n})})})})}function ke(e,r){let t=n=>n.startsWith("http")?n:`https://${n}`;try{let n=c=>c.startsWith("http")?c:`https://${c}`,i=(typeof e=="string"?new xt.URL(n(e)):e).hostname;switch(process.env.FAVICON_PROVIDER??"raycast"){case"none":return{source:r?.fallback??u.Icon.Link,mask:r?.mask};case"apple":return{source:r?.fallback??u.Icon.Link,mask:r?.mask};case"duckduckgo":case"duckDuckGo":return{source:`https://icons.duckduckgo.com/ip3/${i}.ico`,fallback:r?.fallback??u.Icon.Link,mask:r?.mask};case"google":return{source:`https://www.google.com/s2/favicons?sz=${r?.size??64}&domain=${i}`,fallback:r?.fallback??u.Icon.Link,mask:r?.mask};case"legacy":case"raycast":default:return{source:`https://api.ray.so/favicon?url=${i}&size=${r?.size??64}`,fallback:r?.fallback??u.Icon.Link,mask:r?.mask}}}catch(n){return console.error(n),u.Icon.Link}}var W=class e{constructor(r,t,n,a,i,o){this.title=r;this.url=t;this.favicon=n;this.windowsId=a;this.tabIndex=i;this.sourceLine=o}static TAB_CONTENTS_SEPARATOR="~~~";static parse(r){let t=r.split(this.TAB_CONTENTS_SEPARATOR);return new e(t[0],t[1],t[2],+t[3],+t[4],r)}key(){return`${this.windowsId}${e.TAB_CONTENTS_SEPARATOR}${this.tabIndex}`}urlWithoutScheme(){return this.url.replace(/(^\w+:|^)\/\//,"").replace("www.","")}realFavicon(){return new URL(this.favicon||"/favicon.ico",this.url).href}googleFavicon(){return ke(this.url)}};async function Rt(e){let r=e?`execute t javascript \xAC
        "document.head.querySelector('link[rel~=icon]') ? document.head.querySelector('link[rel~=icon]').href : '';"`:'""';await Ue();try{return(await H(`
      set _output to ""
      tell application "Google Chrome"
        repeat with w in windows
          set _w_id to get id of w as inches as string
          set _tab_index to 1
          repeat with t in tabs of w
            set _title to get title of t
            set _url to get URL of t
            set _favicon to ${r}
            set _output to (_output & _title & "${W.TAB_CONTENTS_SEPARATOR}" & _url & "${W.TAB_CONTENTS_SEPARATOR}" & _favicon & "${W.TAB_CONTENTS_SEPARATOR}" & _w_id & "${W.TAB_CONTENTS_SEPARATOR}" & _tab_index & "\\n")
            set _tab_index to _tab_index + 1
          end repeat
        end repeat
      end tell
      return _output
  `)).split(`
`).filter(n=>n.length!==0).map(n=>W.parse(n))}catch(t){return t.message.includes(`Can't get application "Google Chrome"`)&&z.LocalStorage.removeItem("is-installed"),await Ue(),[]}}async function oe({url:e,query:r,profileCurrent:t,profileOriginal:n,openTabInProfile:a}){setTimeout(()=>{(0,z.popToRoot)({clearSearchBar:!0})},3e3),await Promise.all([(0,z.closeMainWindow)({clearRootSearch:!0}),Ue()]);let i="",o=c=>`
    set profile to quoted form of "${c}"
    set link to quoted form of "${e||"about:blank"}"
    do shell script "open -na 'Google Chrome' --args --profile-directory=" & profile & " " & link
  `;switch(a){case"default":i=`
        set winExists to false
        tell application "Google Chrome"
            repeat with win in every window
                if index of win is 1 then
                    set winExists to true
                    exit repeat
                end if
            end repeat

            if not winExists then
                make new window
            else
                activate
            end if

            tell window 1
                set newTab to make new tab `+(e?`with properties {URL:"${e}"}`:r?'with properties {URL:"https://www.google.com/search?q='+r+'"}':"")+`
            end tell
        end tell
        return true

  `;break;case"profile_current":i=o(t);break;case"profile_original":i=o(n);break}return await H(i)}async function _t(e){await H(`
    tell application "Google Chrome"
      activate
      set _wnd to first window where id is ${e.windowsId}
      set index of _wnd to 1
      set active tab index of _wnd to ${e.tabIndex}
    end tell
    return true
  `)}async function Pt(e){await H(`
    tell application "Google Chrome"
      activate
      set _wnd to first window where id is ${e.windowsId}
      set index of _wnd to 1
      set active tab index of _wnd to ${e.tabIndex}
      close active tab of _wnd
    end tell
    return true
  `)}async function At(e){await H(`
    tell application "Google Chrome"
      activate
      set _wnd to first window where id is ${e.windowsId}
      set index of _wnd to 1
      set active tab index of _wnd to ${e.tabIndex}
      tell active tab of _wnd to reload
    end tell
    return true
  `)}var Ue=async()=>{if(await z.LocalStorage.getItem("is-installed"))return;if(await H(`
set isInstalled to false
try
    do shell script "osascript -e 'exists application \\"Google Chrome\\"'"
    set isInstalled to true
end try

return isInstalled`)==="false")throw new Error(q);z.LocalStorage.setItem("is-installed",!0)};var $=require("react/jsx-runtime"),ie=class{static NewTab=xr;static TabList=Er;static TabHistory=Sr};function xr({query:e,url:r}){let{openTabInProfile:t}=(0,b.getPreferenceValues)(),[n]=O(M,P),a="Open Empty Tab";return e?a=`Search "${e}"`:r&&(a=`Open URL "${r}"`),(0,$.jsx)(b.ActionPanel,{title:"New Tab",children:(0,$.jsx)(b.Action,{onAction:()=>oe({url:r,query:e,profileCurrent:n,openTabInProfile:t}),title:a})})}function Er({tab:e,onTabClosed:r}){return(0,$.jsxs)(b.ActionPanel,{title:e.title,children:[(0,$.jsx)(vr,{tab:e}),(0,$.jsx)(Rr,{tab:e}),(0,$.jsx)(b.Action.CopyToClipboard,{title:"Copy URL",content:e.url}),(0,$.jsx)(b.Action.CopyToClipboard,{title:"Copy Title",content:e.title,shortcut:{modifiers:["cmd","shift"],key:"enter"}}),(0,$.jsx)(Tr,{tab:e,onTabClosed:r}),(0,$.jsx)(b.ActionPanel.Section,{children:(0,$.jsx)(b.Action.CreateQuicklink,{quicklink:{link:e.url,name:e.title,application:"Google Chrome"},shortcut:{modifiers:["cmd"],key:"s"}})})]})}function Sr({title:e,url:r,profile:t}){let{openTabInProfile:n}=(0,b.getPreferenceValues)(),[a]=O(M,P);return(0,$.jsxs)(b.ActionPanel,{title:e,children:[(0,$.jsx)(b.Action,{onAction:()=>oe({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:n}),title:"Open"}),(0,$.jsxs)(b.ActionPanel.Section,{title:"Open in profile",children:[(0,$.jsx)(b.Action,{onAction:()=>oe({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:"profile_current"}),title:"Open in Current Profile"}),(0,$.jsx)(b.Action,{onAction:()=>oe({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:"profile_original"}),title:"Open in Original Profile"})]}),(0,$.jsx)(b.Action.CopyToClipboard,{title:"Copy URL",content:r,shortcut:{modifiers:["cmd"],key:"c"}})]})}function vr(e){async function r(){try{await _t(e.tab),await(0,b.closeMainWindow)()}catch(t){throw t instanceof Error?new Error("Issue with tab: '"+e.tab.sourceLine+`'
`+t.message):t}}return(0,$.jsx)(b.ActionPanel.Item,{title:"Open Tab",icon:{source:b.Icon.Eye},onAction:r})}function Tr(e){async function r(){await Pt(e.tab),await(0,b.closeMainWindow)(),e.onTabClosed?.()}return(0,$.jsx)(b.Action,{title:"Close Tab",icon:{source:b.Icon.XMarkCircle},onAction:r,shortcut:{modifiers:["cmd","shift"],key:"w"}})}function Rr(e){async function r(){try{await At(e.tab),await(0,b.closeMainWindow)()}catch(t){throw t instanceof Error?new Error("Issue with tab: '"+e.tab.sourceLine+`'
`+t.message):t}}return(0,$.jsx)(b.Action,{title:"Reload Tab",icon:{source:b.Icon.ArrowClockwise},onAction:r,shortcut:{modifiers:["cmd","shift"],key:"r"}})}var De=require("@raycast/api");var se=require("react/jsx-runtime"),G=class{static TabList=Pr;static TabHistory=_r};function _r({profile:e,entry:{url:r,title:t,id:n},type:a}){return(0,se.jsx)(De.List.Item,{id:`${e}-${a}-${n}`,title:t,subtitle:r,icon:ke(r),actions:(0,se.jsx)(ie.TabHistory,{title:t,url:r,profile:e})})}function Pr(e){return(0,se.jsx)(De.List.Item,{title:e.tab.title,subtitle:e.tab.urlWithoutScheme(),keywords:[e.tab.urlWithoutScheme()],actions:(0,se.jsx)(ie.TabList,{tab:e.tab,onTabClosed:e.onTabClosed}),icon:e.useOriginalFavicon?e.tab.realFavicon():e.tab.googleFavicon()})}var Ne=require("react");var Ct=require("@raycast/api");var Me=require("react/jsx-runtime");function It(e=""){let{useOriginalFavicon:r}=(0,Ct.getPreferenceValues)(),[t,n]=(0,Ne.useState)(),[a,i]=(0,Ne.useState)(!1),{isLoading:o,data:c}=re((l,f)=>Rt(l).then(d=>{let y=f.toLowerCase().split(/\s+/);return n(void 0),i(d.length===0),d.map(p=>[p,`${p.title.toLowerCase()} ${p.urlWithoutScheme().toLowerCase()}`]).filter(([,p])=>y.reduce((k,m)=>k&&p.includes(m),!0)).map(([p])=>p)}),[r,e],{onError(l){l.message===q?n((0,Me.jsx)(Q,{})):n((0,Me.jsx)(me,{}))}});return{data:a?[]:c||[],isLoading:o,errorView:t}}var Dt=x(require("fs")),B=x(require("@raycast/api"));var Ot=x(require("node:fs")),Lt=x(require("node:path")),K=require("@raycast/api"),Ut=e=>{let r=!0,t="[Extension Name]...",n="";try{let o=JSON.parse(Ot.readFileSync(Lt.join(K.environment.assetsPath,"..","package.json"),"utf8"));t=`[${o.title}]...`,n=`https://raycast.com/${o.owner||o.author}/${o.name}`,(!o.owner||o.access==="public")&&(r=!1)}catch{}let a=K.environment.isDevelopment||r,i=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(o){o.hide(),a?K.Clipboard.copy(i):(0,K.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};var ne=require("react");var Nt=require("react/jsx-runtime"),Ar=(e,r)=>r.map(t=>`(${e}.title LIKE '%${t}%' OR ${e}.url LIKE '%${t}%')`).join(" AND "),Cr=(e,r,t)=>`SELECT id,
            url,
            title,
            datetime(${r} /
                     1000000 +
                     (strftime('%s', '1601-01-01')),
                     'unixepoch',
                     'localtime') as lastVisited
     FROM ${e}
     WHERE ${Ar(e,t)}
     AND last_visit_time > 0
     ORDER BY ${r} DESC LIMIT 30;`,Ir=(e,r)=>{let t=r?r.trim().split(" "):[""],n=Cr("urls","last_visit_time",t),a=Ze(e);if(!Dt.existsSync(a))return{isLoading:!1,data:[],errorView:(0,Nt.jsx)(Q,{})};let[i,o]=(0,ne.useState)(!1),[c,s]=(0,ne.useState)(0),[l,f]=(0,ne.useState)(null);(0,ne.useEffect)(()=>()=>{l&&clearTimeout(l)},[l]);let{data:d,isLoading:y,permissionView:p,revalidate:k}=Tt(a,n,{onData(){o(!1),s(0),f(null)},onError(m){if(c<1){o(!0),s(c+1);let S=setTimeout(()=>{k(),clearTimeout(S)},1e3);f(S)}else o(!1),s(0),f(null),B.environment.launchType!==B.LaunchType.Background&&B.showToast({style:B.Toast.Style.Failure,title:"Failed to load history",message:m.message,primaryAction:Ut(m)})}});return{data:d,isLoading:y||i,errorView:p,revalidate:k}};function Fe(e,r){return Ir(e,r)}var Lr=require("@raycast/api"),Ur=require("react");var Ve=require("@raycast/api"),We=require("react");var xe=require("fs");var ze=require("react/jsx-runtime");async function Or(){let e=fe();if(!(0,xe.existsSync)(e))return[{name:"Default",id:"Default"}];let r=await xe.promises.readFile(e,"utf-8"),t=JSON.parse(r).profile.info_cache;return Object.entries(t).map(([n,a])=>({name:a.name,id:n}))}function Ee({onProfileSelected:e}){let[r,t]=O(M,P),[n,a]=O(tt,[{name:"Person 1",id:P}]),{data:i}=vt(Or);return(0,We.useEffect)(()=>{i&&(a(i),r||(i.length>0?t(i[0].id):t(P)))},[i]),(0,We.useEffect)(()=>{r&&e?.(r)},[r]),!n||n.length<2?null:(0,ze.jsx)(Ve.List.Dropdown,{tooltip:"Select Chrome Profile",value:r,onChange:t,children:n.map(o=>(0,ze.jsx)(Ve.List.Dropdown.Item,{value:o.id,title:o.name},o.id))})}var Dr=require("react/jsx-runtime"),Mt=e=>e?e.reduce((r,t)=>{let n=new Date(t.lastVisited).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),a=r.get(n)??[];return a.push(t),r.set(n,a),r},new Map):new Map;var Be=require("react");var je=require("react/jsx-runtime");function Ft(e,r){let[t,n]=(0,Be.useState)(!1),[a,i]=(0,Be.useState)(),{isLoading:o,data:c,revalidate:s}=re((f,d)=>qe(f).then(y=>(i(void 0),n(y.length===0),y.filter(p=>p.title.toLowerCase().includes(d?.toLowerCase()||"")||p.url.toLowerCase().includes(d?.toLowerCase()||"")))),[e,r],{onError(f){f.message===q?i((0,je.jsx)(Q,{})):f.message===de?n(!0):i((0,je.jsx)(me,{}))}});return{errorView:a,isLoading:o,data:t?[]:c||[],revalidate:s}}var E=require("react/jsx-runtime");function Wt(){let{useOriginalFavicon:e}=(0,I.getPreferenceValues)(),[r,t]=(0,Vt.useState)(""),[n]=O(M,P),{data:a,isLoading:i}=It(r),{data:o=[],isLoading:c,revalidate:s}=Fe(n,r),{data:l,isLoading:f,revalidate:d}=Ft(n,r);return(0,E.jsxs)(I.List,{isLoading:i||c||f,onSearchTextChange:t,throttle:!0,searchBarAccessory:(0,E.jsx)(Ee,{onProfileSelected:p=>{s?.(p),d(p)}}),children:[(0,E.jsx)(I.List.Section,{title:"Tabs",children:i?(0,E.jsx)(I.List.Item,{title:"Loading tabs..."},"loading tab list item"):a.length===0?(0,E.jsx)(I.List.Item,{title:"No tabs found"},"empty tab list item"):a.map(p=>(0,E.jsx)(G.TabList,{tab:p,useOriginalFavicon:e},p.key()))}),o.length===0?(0,E.jsx)(I.List.Section,{title:"History",children:(0,E.jsx)(I.List.Item,{title:"No history found"})}):Array.from(Mt(o).entries(),([p,k])=>(0,E.jsx)(I.List.Section,{title:"History "+p,children:k.map(m=>(0,E.jsx)(G.TabHistory,{entry:m,profile:n,type:"History"},m.id))},p)),(0,E.jsx)(I.List.Section,{title:"Bookmarks",children:l.length===0?(0,E.jsx)(I.List.Item,{title:"No bookmarks found"},"empty bookmark list item"):l.map(p=>(0,E.jsx)(G.TabHistory,{entry:p,profile:n,type:"Bookmark"},p.id))})]})}
